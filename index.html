<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YOHAN H4X Panel Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for modal */
        #cart-items-container::-webkit-scrollbar, 
        #order-summary-container::-webkit-scrollbar {
            width: 8px;
        }
        #cart-items-container::-webkit-scrollbar-track, 
        #order-summary-container::-webkit-scrollbar-track {
            background: #1f2937;
        }
        #cart-items-container::-webkit-scrollbar-thumb, 
        #order-summary-container::-webkit-scrollbar-thumb {
            background-color: #dc2626;
            border-radius: 20px;
        }
        /* Style for the temporary success message box */
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 60;
            background: #1f2937;
            border: 3px solid #facc15;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(250, 202, 25, 0.4);
            max-width: 90%;
            width: 450px;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-900 text-white">

    <!-- Header / Navigation -->
    <header id="header" class="sticky top-0 z-40 bg-gray-900 border-b-4 border-red-700/50 shadow-2xl">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-4 cursor-pointer" onclick="switchView('shop')">
                <svg xmlns="http://www.w3.org/2000/svg" class="text-yellow-400 w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 10h16M4 14h16M4 18h16M4 6h16"/></svg>
                <h1 class="text-3xl font-extrabold tracking-tight text-white uppercase">
                    YOHAN H4X <span class="text-yellow-400">PANEL STORE</span>
                </h1>
            </div>
            
            <nav class="hidden md:flex space-x-8 text-lg font-medium">
                <button onclick="switchView('shop')" class="hover:text-red-500 transition duration-150">Shop</button>
                <a href="#" class="hover:text-red-500 transition duration-150">Dashboard</a>
                <a href="#" class="hover:text-red-500 transition duration-150">Support</a>
            </nav>

            <button
                id="cart-button"
                onclick="toggleCart()"
                class="relative p-3 bg-red-700 hover:bg-red-600 rounded-full transition-all active:scale-95"
            >
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
                <span id="cart-item-count" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-yellow-500 rounded-full">
                    0
                </span>
            </button>
        </div>
    </header>

    <!-- Temporary Message Box -->
    <div id="message-container" class="hidden message-box"></div>

    <!-- Main Content Wrapper to switch views -->
    <div id="view-wrapper">
        <!-- SHOP VIEW -->
        <div id="shop-view">
            <!-- Hero Section -->
            <section class="bg-gray-800 py-20 px-4 sm:px-6 lg:px-8 text-center border-b-4 border-gray-700">
                <h2 class="text-5xl md:text-6xl font-black text-white mb-4 leading-tight">
                    DOMINATE THE FIELD. <span class="text-yellow-400">GO H4X.</span>
                </h2>
                <p class="text-xl text-gray-300 max-w-3xl mx-auto mb-6">
                    The official YOHAN H4X Panel Store: advanced, safe, and lifetime tools for **IOS & ANDROID** to ensure 100% Headshots and Auto Aim.
                </p>

                <!-- Active Panel Users Statistic -->
                <div class="inline-block bg-red-800/50 border border-red-600 rounded-lg p-3 px-6 mb-10 shadow-lg shadow-red-900/50">
                    <span class="text-2xl font-black text-yellow-400">5,200+</span> 
                    <span class="text-lg font-semibold text-gray-200 ml-2">Active Panel Users</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="inline ml-2 w-5 h-5 text-lime-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0-4.4-3.6-8-8-8s-8 3.6-8 8c0 7 8 12 8 12s8-5 8-12z"/><circle cx="12" cy="10" r="3"/></svg>
                </div>
                
                <div class="flex justify-center space-x-4 px-4">
                    <button class="flex items-center justify-center w-full max-w-xs sm:max-w-sm bg-yellow-600 hover:bg-yellow-500 text-gray-900 text-lg font-bold py-3 px-8 rounded-lg shadow-xl shadow-yellow-900/50 transition-all active:scale-95">
                        <svg xmlns="http://www.w3.org/2000/svg" class="mr-2 w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 10h16M4 14h16M4 18h16M4 6h16"/></svg> 
                        Contact Now (0770490971)
                    </button>
                </div>
            </section>

            <!-- Main Product Grid -->
            <main class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
                
                <!-- YOHAN H4X MOBILE PANEL STORE SECTION -->
                <h2 class="text-4xl font-extrabold mb-8 border-l-4 border-yellow-500 pl-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="inline mr-2 text-yellow-400 w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z" fill="currentColor"/></svg> Mobile (IOS & ANDROID) Panels <span class="text-red-500">⭐ LIFETIME ACCESS</span>
                </h2>
                <p class="text-gray-400 mb-8 text-lg font-semibold bg-gray-800 p-4 rounded-lg border border-gray-700 shadow-inner">
                *Note: These are advanced, **lifetime access** panels for **IOS & ANDROID**. Main ID Full Safe. For purchase contact **0770490971***
                </p>

                <div id="mobile-product-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-20">
                    <!-- Mobile Products will be injected here -->
                </div>
                
                <!-- YOHAN H4X PC PANEL STORE SECTION (NEW) -->
                <h2 class="text-4xl font-extrabold mt-16 mb-8 border-l-4 border-yellow-500 pl-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="inline mr-2 text-yellow-400 w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="12" y1="3" x2="12" y2="21"/></svg> PC (WINDOWS) Panels <span class="text-red-500">⚡ SUBSCRIPTION</span>
                </h2>
                <p class="text-gray-400 mb-8 text-lg font-semibold bg-gray-800 p-4 rounded-lg border border-gray-700 shadow-inner">
                *Note: These panels are for PC/Windows and are available on a **monthly subscription** basis. All panels use the same subscription pricing. Contact **0770490971***
                </p>

                <div id="pc-product-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-20">
                    <!-- PC Products will be injected here -->
                </div>

            </main>
        </div>

        <!-- CHECKOUT VIEW (Hidden by default) -->
        <div id="checkout-view" class="hidden max-w-4xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <button onclick="switchView('shop')" class="flex items-center text-red-500 hover:text-red-400 font-semibold mb-6 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
                Back to Shop
            </button>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Order Summary (Column 1 & 2) -->
                <div class="lg:col-span-2 bg-gray-800 border-2 border-red-700/50 rounded-xl p-6 shadow-2xl">
                    <h2 class="text-3xl font-extrabold text-white mb-6 border-b border-gray-700 pb-3">Order Summary</h2>
                    <div id="order-summary-container" class="max-h-[50vh] overflow-y-auto pr-2">
                        <!-- Summary Items injected here -->
                    </div>
                    
                    <div class="mt-6 pt-4 border-t-2 border-yellow-500/50 flex justify-between items-center">
                        <span class="text-2xl font-bold text-gray-300">Grand Total:</span>
                        <span id="checkout-total-rs" class="text-4xl font-black text-yellow-400">RS 0</span>
                    </div>
                </div>

                <!-- Contact Form (Column 3) -->
                <div class="lg:col-span-1 bg-gray-800 border-2 border-red-700/50 rounded-xl p-6 shadow-2xl">
                    <h2 class="text-2xl font-bold text-white mb-4">Your Contact Details</h2>
                    <p class="text-sm text-gray-400 mb-4">We need this information to send you the panel access link and instructions.</p>
                    
                    <form id="contact-form">
                        <div class="mb-4">
                            <label for="buyer-name" class="block text-sm font-medium text-gray-300 mb-1">Your Name</label>
                            <input type="text" id="buyer-name" required class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:ring-red-500 focus:border-red-500">
                        </div>
                        <div class="mb-6">
                            <label for="contact-number" class="block text-sm font-medium text-gray-300 mb-1">WhatsApp/Telegram Number</label>
                            <input type="tel" id="contact-number" required placeholder="e.g., 0770490971" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:ring-red-500 focus:border-red-500">
                        </div>
                        
                        <button
                            type="submit"
                            id="confirm-order-button"
                            class="w-full bg-yellow-600 hover:bg-yellow-500 text-gray-900 font-extrabold py-3 rounded-lg text-lg transition-all shadow-xl shadow-yellow-900/50 active:scale-95"
                        >
                            CONFIRM ORDER & SEND TO WHATSAPP
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <!-- Footer -->
    <footer class="bg-gray-900 border-t border-gray-700 py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-400 text-sm">
            <p>&copy; <span id="current-year"></span> YOHAN H4X Panel Store. All rights reserved.</p>
        </div>
    </footer>

    <!-- Cart Modal (Hidden by default) -->
    <div id="cart-modal" class="hidden fixed inset-0 z-50 bg-black bg-opacity-80 items-center justify-center p-4">
        <div 
            id="cart-content-container" 
            class="bg-gray-900 w-full max-w-lg rounded-xl border-4 border-red-600 shadow-2xl shadow-red-900/70 transform transition-all duration-300 overflow-hidden" 
        >
            <!-- Modal Header -->
            <div class="p-6 border-b border-gray-700 flex justify-between items-center bg-gray-800">
                <h2 class="text-3xl font-extrabold text-white flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="text-red-500 mr-3 w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg> 
                    Shopping Cart
                </h2>
                <button onclick="toggleCart()" class="text-gray-400 hover:text-red-500 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
            </div>

            <!-- Modal Body: Items -->
            <div id="cart-items-container" class="max-h-96 overflow-y-auto p-6">
                <!-- Cart items will be injected here -->
            </div>

            <!-- Modal Footer: Totals and Checkout -->
            <div class="p-6 border-t border-gray-700 bg-gray-800">
                <div class="text-lg font-medium text-gray-300 mb-2">
                    Total Items: <span id="cart-total-items" class="text-white font-bold">0</span>
                </div>
                
                <div id="cart-subtotal" class="flex justify-between items-center text-xl font-bold text-white mb-4">
                    <span>H4X Panel Subtotal:</span>
                    <span id="subtotal-rs" class="text-red-500">RS 0</span>
                </div>

                <button
                    id="checkout-button"
                    onclick="goToCheckout()"
                    disabled
                    class="w-full bg-red-700 hover:bg-red-600 text-white font-extrabold py-3 rounded-lg text-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-xl shadow-red-900/50"
                >
                    PROCEED TO CHECKOUT
                </button>
            </div>
        </div>
    </div>


    <script type="module">
        // Firebase Imports (Required boilerplate for the canvas environment)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- Globals ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        let db, auth;
        let userId;

        // Target Seller WhatsApp Number (Sri Lanka +94, number 0770490971 becomes 94770490971 for URL)
        const SELLER_WHATSAPP_NUMBER = '94770490971'; 
        const SELLER_DISPLAY_NUMBER = '0770490971'; // For display purposes

        // --- Store State (Local for demo purposes) ---
        let cartItems = [];
        let isCartVisible = false;
        let currentView = 'shop'; // 'shop' or 'checkout'

        // --- Pricing and Product Data ---
        
        const baseProducts = [
            { 
                id: 5, 
                name: "Basic Headshot Panel", 
                price: 2200, 
                image: "https://placehold.co/400x300/540000/ffffff?text=HS+70%25", 
                description: "Headshot 100%70. Includes Anti Cheatz. Compatible with IOS & Android.",
                color: "bg-purple-900/40 text-purple-400",
                currency: "RS",
                platform: 'Mobile',
                access: 'Lifetime'
            },
            { 
                id: 6, 
                name: "Pro Headshot Panel", 
                price: 3300, 
                image: "https://placehold.co/400x300/7a0000/ffffff?text=HS+85%25", 
                description: "Headshot 100%85. Includes Anti Cheatz. Highly reliable performance.",
                color: "bg-purple-900/40 text-purple-400",
                currency: "RS",
                platform: 'Mobile',
                access: 'Lifetime'
            },
            { 
                id: 7, 
                name: "Auto Headshot Panel (BEST)", 
                price: 5500, 
                image: "https://placehold.co/400x300/a00000/ffffff?text=AUTO+HS", 
                description: "The BEST ONE! Full Auto Headshot functionality + Anti Cheatz. Main ID Full Safe.",
                color: "bg-yellow-900/40 text-yellow-400",
                currency: "RS",
                platform: 'Mobile',
                access: 'Lifetime'
            },
            { 
                id: 8, 
                name: "AWM Auto Aim Bundle (NEW)", 
                price: 7500, 
                image: "https://placehold.co/400x300/c70000/ffffff?text=AWM+AIM", 
                description: "NEW! Includes AWM Auto Aim + Auto Headshot. Lifetime access and Main ID Full Safe.",
                color: "bg-lime-900/40 text-lime-400",
                currency: "RS",
                platform: 'Mobile',
                access: 'Lifetime'
            },
        ];

        const pcSubscriptionTiers = [
            { duration: '3 Months', price: 4000, color: "bg-red-900/40 text-red-400" },
            { duration: '2 Months', price: 3000, color: "bg-indigo-900/40 text-indigo-400" },
            { duration: '1 Month', price: 2000, color: "bg-gray-700/40 text-gray-300" }
        ];

        // --- Utility Functions ---

        const formatPrice = (price, currency = 'USD') => {
            if (currency === 'RS') {
                return `RS ${price.toLocaleString('en-IN')}`;
            }
            return `$${price.toFixed(2)}`;
        };

        const getCartCount = () => cartItems.reduce((acc, item) => acc + item.quantity, 0);

        const getCartSubtotalRS = () => 
            cartItems
                .filter(item => item.currency === 'RS')
                .reduce((acc, item) => acc + item.price * item.quantity, 0);
        
        const showMessage = (title, content, type = 'info', duration = 8000) => {
            const container = document.getElementById('message-container');
            let color = '';
            if (type === 'success') color = '#10b981'; // Green
            if (type === 'error') color = '#ef4444'; // Red
            if (type === 'info') color = '#facc15'; // Yellow

            container.innerHTML = `
                <div class="flex flex-col space-y-3">
                    <h3 class="text-xl font-bold text-white border-b-2 pb-2" style="border-color: ${color}">${title}</h3>
                    <p class="text-base text-gray-200">${content}</p>
                    <button onclick="document.getElementById('message-container').classList.add('hidden')" class="bg-red-700 hover:bg-red-600 text-white font-bold py-1 px-4 rounded transition-colors mt-3">Close</button>
                </div>
            `;
            container.style.borderColor = color;
            container.classList.remove('hidden');

            // Optionally auto-hide the message box
            setTimeout(() => {
                container.classList.add('hidden');
            }, duration);
        }

        // --- View Switching Logic ---

        window.switchView = function(viewName) {
            currentView = viewName;
            const shopView = document.getElementById('shop-view');
            const checkoutView = document.getElementById('checkout-view');
            
            shopView.classList.toggle('hidden', viewName !== 'shop');
            checkoutView.classList.toggle('hidden', viewName !== 'checkout');
            
            // Render the checkout view content if we switch to it
            if (viewName === 'checkout') {
                renderCheckout();
            }

            // Ensure cart modal is closed when switching views
            isCartVisible = false; 
            renderCart();
            window.scrollTo(0, 0); // Scroll to top
        }
        
        window.goToCheckout = function() {
            if (cartItems.length > 0) {
                switchView('checkout');
            }
        }

        // --- Checkout Page Rendering ---

        function renderCheckout() {
            const summaryContainer = document.getElementById('order-summary-container');
            const totalEl = document.getElementById('checkout-total-rs');

            if (cartItems.length === 0) {
                summaryContainer.innerHTML = '<p class="text-gray-400 text-center py-10">Your cart is empty. Please add items to proceed to checkout.</p>';
                totalEl.textContent = formatPrice(0, 'RS');
                return;
            }

            const itemsHTML = cartItems.map(item => `
                <div class="flex justify-between items-center py-3 border-b border-gray-700 last:border-b-0">
                    <div class="flex flex-col">
                        <span class="text-lg font-semibold text-white">${item.name}</span>
                        <span class="text-sm text-red-500">${item.platform} - ${item.access} (x${item.quantity})</span>
                    </div>
                    <span class="text-xl font-bold text-yellow-400">${formatPrice(item.price * item.quantity, 'RS')}</span>
                </div>
            `).join('');

            summaryContainer.innerHTML = itemsHTML;
            totalEl.textContent = formatPrice(getCartSubtotalRS(), 'RS');
        }

        // --- Order Submission Handler (UPDATED FOR WHATSAPP) ---

        window.placeOrder = function(event) {
            event.preventDefault();

            const name = document.getElementById('buyer-name').value.trim();
            const number = document.getElementById('contact-number').value.trim();
            const total = getCartSubtotalRS();
            
            if (!name || !number || cartItems.length === 0) {
                showMessage("Order Error", "Please fill in your name and contact number, and ensure your cart is not empty.", 'error', 5000);
                return;
            }

            const orderDetails = cartItems.map(item => 
                `* ${item.name} (${item.platform} - ${item.access}) x ${item.quantity} = ${formatPrice(item.price * item.quantity, 'RS')}`
            ).join('\n');

            const orderMessage = `
*--- NEW H4X PANEL ORDER ---*

*Buyer Name:* ${name}
*Buyer Contact:* ${number}

*Order Items:*
${orderDetails}

*-----------------------------*
*GRAND TOTAL:* ${formatPrice(total, 'RS')}
*-----------------------------*

I confirm the order and am ready to proceed with payment. Please provide the access link!
            `.trim();

            // 1. URL encode the message
            const encodedMessage = encodeURIComponent(orderMessage);

            // 2. Construct the WhatsApp URL
            const whatsappUrl = `https://wa.me/${SELLER_WHATSAPP_NUMBER}?text=${encodedMessage}`;

            // 3. Open the link in a new tab/window
            window.open(whatsappUrl, '_blank');

            // 4. Show success message to the user
            showMessage(
                "Order Sent to WhatsApp!",
                `Your order details have been automatically opened in a new WhatsApp tab/window. Please click the **Send** button in WhatsApp to finalize the order with the seller (${SELLER_DISPLAY_NUMBER}).`,
                'success',
                10000 // Keep this message visible longer
            );

            // Optional: Clear the cart after sending the order for a fresh checkout next time
            // cartItems = []; 
            // switchView('shop');
            // renderCart();
        }

        // Attach form submission listener
        document.addEventListener('DOMContentLoaded', () => {
            const contactForm = document.getElementById('contact-form');
            if (contactForm) {
                contactForm.addEventListener('submit', placeOrder);
            }
        });


        // --- Core Application Functions (Cart and Products) ---

        function renderCartItem(item) {
            const totalItemPrice = formatPrice(item.price * item.quantity, item.currency);
            const iconSvg = item.access === 'Lifetime' ? 
                `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z" fill="currentColor"/></svg>` :
                `<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="12" y1="3" x2="12" y2="21"/></svg>`;
            
            const colorClass = item.color;
            
            return `
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between border-b border-gray-700 py-4 last:border-b-0">
                    <!-- Product Info -->
                    <div class="flex items-center space-x-4 mb-2 sm:mb-0">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center text-sm ${colorClass}">
                            ${iconSvg}
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-semibold">${item.name.replace(` - ${item.access}`, '')}</p>
                            <p class="text-red-500 text-sm">${item.platform} - ${item.access}</p>
                        </div>
                    </div>
                    
                    <!-- Quantity Controls and Total (Responsive layout) -->
                    <div class="flex items-center justify-between w-full sm:w-auto sm:space-x-3">
                        <div class="flex items-center border border-gray-600 rounded-full">
                            <button 
                                onclick="updateCartQuantity(${item.id}, ${item.quantity - 1})"
                                class="p-1 text-gray-400 hover:text-red-500 ${item.quantity === 1 ? 'opacity-30 cursor-not-allowed' : ''}"
                                ${item.quantity === 1 ? 'disabled' : ''}
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/></svg>
                            </button>
                            <span class="text-white w-6 text-center">${item.quantity}</span>
                            <button 
                                onclick="updateCartQuantity(${item.id}, ${item.quantity + 1})"
                                class="p-1 text-gray-400 hover:text-red-500"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                            </button>
                        </div>
                        <!-- Total price -->
                        <span class="text-xl font-bold text-white w-20 text-right">
                            ${totalItemPrice}
                        </span>
                    </div>
                </div>
            `;
        }

        function renderCart() {
            const cartModal = document.getElementById('cart-modal');
            const cartItemsContainer = document.getElementById('cart-items-container');
            const cartItemCountEl = document.getElementById('cart-item-count');
            const cartTotalItemsEl = document.getElementById('cart-total-items');
            const subtotalRSEl = document.getElementById('subtotal-rs');
            const checkoutButton = document.getElementById('checkout-button');

            // 1. Update Modal Visibility
            if (isCartVisible) {
                cartModal.classList.remove('hidden');
                cartModal.classList.add('flex');
            } else {
                cartModal.classList.add('hidden');
                cartModal.classList.remove('flex');
            }

            // 2. Update Cart Items List
            if (cartItems.length === 0) {
                cartItemsContainer.innerHTML = '<p class="text-gray-400 text-center py-8">Your cart is empty. Time to gear up!</p>';
                checkoutButton.disabled = true;
            } else {
                cartItemsContainer.innerHTML = cartItems.map(renderCartItem).join('');
                checkoutButton.disabled = false;
            }

            // 3. Update Totals and Count
            const count = getCartCount();
            const subtotalRS = getCartSubtotalRS();

            cartItemCountEl.textContent = count;
            cartItemCountEl.style.display = count > 0 ? 'inline-flex' : 'none';
            cartTotalItemsEl.textContent = count;
            subtotalRSEl.textContent = formatPrice(subtotalRS, 'RS');
        }

        window.toggleCart = function() {
            isCartVisible = !isCartVisible;
            renderCart();
        }

        window.addToCart = function(product) {
            const existingItem = cartItems.find(item => item.id === product.id);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cartItems.push({ ...product, quantity: 1 });
            }
            
            isCartVisible = true;
            renderCart();
        }

        window.updateCartQuantity = function(id, newQuantity) {
            if (newQuantity <= 0) {
                cartItems = cartItems.filter(item => item.id !== id);
            } else {
                const item = cartItems.find(item => item.id === id);
                if (item) {
                    item.quantity = newQuantity;
                }
            }
            renderCart();
        }

        function renderMobileProducts() {
            const productGrid = document.getElementById('mobile-product-grid');
            const mobileProducts = baseProducts.filter(p => p.platform === 'Mobile');
            
            productGrid.innerHTML = mobileProducts.map(product => {
                const price = formatPrice(product.price, product.currency);
                return `
                    <div class="bg-gray-800 border-2 border-red-700/50 rounded-lg overflow-hidden shadow-2xl transition-transform transform hover:scale-[1.02] duration-300 flex flex-col">
                        <div class="p-4 ${product.color} text-sm font-bold uppercase flex justify-between items-center">
                            <span>${product.name}</span>
                            <span class="text-xs text-lime-400 bg-black/50 px-2 py-0.5 rounded-full">LIFETIME</span>
                        </div>
                        <img 
                            src="${product.image}" 
                            alt="${product.name}" 
                            class="w-full h-48 object-cover object-center"
                            onerror="this.onerror=null; this.src='https://placehold.co/400x300/333/fff?text=No+Image';"
                        />
                        <div class="p-5 flex-grow flex flex-col justify-between">
                            <div>
                                <h3 class="text-xl font-extrabold text-white mb-2">${product.name}</h3>
                                <p class="text-gray-400 text-sm mb-4">${product.description}</p>
                            </div>
                            <div class="flex items-center justify-between mt-4">
                                <span class="text-2xl font-black text-red-500">
                                    ${price}
                                </span>
                                <button
                                    onclick='addToCart(${JSON.stringify(product).replace(/'/g, "\\'")})'
                                    class="flex items-center space-x-2 bg-red-700 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full transition-all shadow-lg shadow-red-900/50 active:scale-95"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
                                    <span>Add to Cart</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderPCProducts() {
            const productGrid = document.getElementById('pc-product-grid');
            
            const pcPanelHTML = baseProducts.map((baseProduct, index) => {
                const pcProductBase = { ...baseProduct, platform: 'PC' };
                
                const subscriptionOptions = pcSubscriptionTiers.map((tier, tierIndex) => {
                    const uniqueId = 1000 + index * 10 + tierIndex; 
                    
                    const productData = {
                        id: uniqueId,
                        name: `${baseProduct.name} - ${tier.duration}`,
                        price: tier.price,
                        currency: 'RS',
                        platform: 'PC',
                        access: tier.duration,
                        color: tier.color 
                    };

                    const price = formatPrice(tier.price, 'RS');
                    
                    return `
                        <div class="flex justify-between items-center py-2 px-3 mb-2 rounded-md ${tier.color}">
                            <span class="text-sm font-semibold">${tier.duration} Access:</span>
                            <div class="flex items-center space-x-3">
                                <span class="text-lg font-black text-white">${price}</span>
                                <button
                                    onclick='addToCart(${JSON.stringify(productData).replace(/'/g, "\\'")})'
                                    class="text-xs bg-red-600 hover:bg-red-500 text-white font-bold py-1 px-3 rounded-full transition-all active:scale-90 shadow-md shadow-red-900/50"
                                >
                                    ADD
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="bg-gray-800 border-2 border-red-700/50 rounded-lg overflow-hidden shadow-2xl flex flex-col">
                        <div class="p-4 ${pcProductBase.color} text-sm font-bold uppercase flex justify-between items-center">
                            <span>PC Panel: ${pcProductBase.name}</span>
                            <span class="text-xs text-yellow-400 bg-black/50 px-2 py-0.5 rounded-full">SUBSCRIPTION</span>
                        </div>
                        <img 
                            src="${pcProductBase.image}" 
                            alt="${pcProductBase.name}" 
                            class="w-full h-32 object-cover object-center"
                            onerror="this.onerror=null; this.src='https://placehold.co/400x300/333/fff?text=PC+Panel';"
                        />
                        <div class="p-5 flex-grow">
                            <h3 class="text-xl font-extrabold text-white mb-3">${pcProductBase.name}</h3>
                            <p class="text-gray-400 text-sm mb-4">PC Version - ${pcProductBase.description.split('.').slice(0, 1)}.</p>
                            <h4 class="text-sm font-bold text-yellow-400 mb-2 border-b border-gray-700 pb-1">Select Duration:</h4>
                            ${subscriptionOptions}
                        </div>
                    </div>
                `;
            }).join('');

            productGrid.innerHTML = pcPanelHTML;
        }

        // --- Firebase Initialization ---
        async function initializeFirebase() {
            if (Object.keys(firebaseConfig).length === 0) {
                console.warn("Firebase config not available. Running in local state mode.");
                return;
            }
            
            try {
                // setLogLevel('debug'); 
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("Firebase/Auth Ready. User ID:", userId);
                    } else {
                        userId = crypto.randomUUID(); 
                        console.log("Signed in anonymously. Temporary User ID:", userId);
                    }
                });

            } catch (error) {
                console.error("Failed to initialize or sign into Firebase:", error);
            }
        }

        // --- Main Initialization ---
        window.onload = function() {
            document.getElementById('current-year').textContent = new Date().getFullYear();
            
            // Initial view setup
            document.getElementById('shop-view').classList.remove('hidden');
            document.getElementById('checkout-view').classList.add('hidden');

            renderMobileProducts();
            renderPCProducts(); 
            renderCart();
            initializeFirebase();

            // Close modal when clicking outside of the content container
            document.getElementById('cart-modal').addEventListener('click', (e) => {
                if (e.target.id === 'cart-modal') {
                    toggleCart();
                }
            });
            
            // Re-attach form listener on load for robustness
            const contactForm = document.getElementById('contact-form');
            if (contactForm) {
                contactForm.addEventListener('submit', placeOrder);
            }
        };

    </script>
</body>
</html>
